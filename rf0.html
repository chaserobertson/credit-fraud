
<script src="https://d3js.org/d3.v6.min.js"></script>
<div id="tree_plot_93339f508e1d4f5980ac5dacfec565b6"></div>
<script>
/*
 * Copyright 2021 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 *  Plotting of decision trees generated by TF-DF.
 *
 *  A tree is a recursive structure of node objects.
 *  A node contains one or more of the following components:
 *
 *    - A value: Representing the output of the node. If the node is not a leaf,
 *      the value is only present for analysis i.e. it is not used for
 *      predictions.
 *
 *    - A condition : For non-leaf nodes, the condition (also known as split)
 *      defines a binary test to branch to the positive or negative child.
 *
 *    - An explanation: Generally a plot showing the relation between the label
 *      and the condition to give insights about the effect of the condition.
 *
 *    - Two children : For non-leaf nodes, the children nodes. The first
 *      children (i.e. "node.children[0]") is the negative children (drawn in
 *      red). The second children is the positive one (drawn in green).
 *
 */

/**
 * Plots a single decision tree into a DOM element.
 * @param {!options} options Dictionary of configurations.
 * @param {!tree} raw_tree Recursive tree structure.
 * @param {string} canvas_id Id of the output dom element.
 */
function display_tree(options, raw_tree, canvas_id) {
  console.log(options);

  // Determine the node placement.
  const tree_struct = d3.tree().nodeSize(
      [options.node_y_offset, options.node_x_offset])(d3.hierarchy(raw_tree));

  // Boundaries of the node placement.
  let x_min = Infinity;
  let x_max = -x_min;
  let y_min = Infinity;
  let y_max = -x_min;

  tree_struct.each(d => {
    if (d.x > x_max) x_max = d.x;
    if (d.x < x_min) x_min = d.x;
    if (d.y > y_max) y_max = d.y;
    if (d.y < y_min) y_min = d.y;
  });

  // Size of the plot.
  const width = y_max - y_min + options.node_x_size + options.margin * 2;
  const height = x_max - x_min + options.node_y_size + options.margin * 2 +
      options.node_y_offset - options.node_y_size;

  const plot = d3.select(canvas_id);

  // Tool tip
  options.tooltip = plot.append('div')
                        .attr('width', 100)
                        .attr('height', 100)
                        .style('padding', '4px')
                        .style('background', '#fff')
                        .style('box-shadow', '4px 4px 0px rgba(0,0,0,0.1)')
                        .style('border', '1px solid black')
                        .style('font-family', 'sans-serif')
                        .style('font-size', options.font_size)
                        .style('position', 'absolute')
                        .style('z-index', '10')
                        .attr('pointer-events', 'none')
                        .style('display', 'none');

  // Create canvas
  const svg = plot.append('svg').attr('width', width).attr('height', height);
  const graph =
      svg.style('overflow', 'visible')
          .append('g')
          .attr('font-family', 'sans-serif')
          .attr('font-size', options.font_size)
          .attr(
              'transform',
              () => `translate(${options.margin},${
                  - x_min + options.node_y_offset / 2 + options.margin})`);

  // Plot bounding box.
  if (options.show_plot_bounding_box) {
    svg.append('rect')
        .attr('width', width)
        .attr('height', height)
        .attr('fill', 'none')
        .attr('stroke-width', 1.0)
        .attr('stroke', 'black');
  }

  // Draw the edges.
  display_edges(options, graph, tree_struct);

  // Draw the nodes.
  display_nodes(options, graph, tree_struct);
}

/**
 * Draw the nodes of the tree.
 * @param {!options} options Dictionary of configurations.
 * @param {!graph} graph D3 search handle containing the graph.
 * @param {!tree_struct} tree_struct Structure of the tree (node placement,
 *     data, etc.).
 */
function display_nodes(options, graph, tree_struct) {
  const nodes = graph.append('g')
                    .selectAll('g')
                    .data(tree_struct.descendants())
                    .join('g')
                    .attr('transform', d => `translate(${d.y},${d.x})`);

  nodes.append('rect')
      .attr('x', 0.5)
      .attr('y', 0.5)
      .attr('width', options.node_x_size)
      .attr('height', options.node_y_size)
      .attr('stroke', 'lightgrey')
      .attr('stroke-width', 1)
      .attr('fill', 'white')
      .attr('y', -options.node_y_size / 2);

  // Brackets on the right of condition nodes without children.
  non_leaf_node_without_children =
      nodes.filter(node => node.data.condition != null && node.children == null)
          .append('g')
          .attr('transform', `translate(${options.node_x_size},0)`);

  non_leaf_node_without_children.append('path')
      .attr('d', 'M0,0 C 10,0 0,10 10,10')
      .attr('fill', 'none')
      .attr('stroke-width', 1.0)
      .attr('stroke', '#F00');

  non_leaf_node_without_children.append('path')
      .attr('d', 'M0,0 C 10,0 0,-10 10,-10')
      .attr('fill', 'none')
      .attr('stroke-width', 1.0)
      .attr('stroke', '#0F0');

  const node_content = nodes.append('g').attr(
      'transform',
      `translate(0,${options.node_padding - options.node_y_size / 2})`);

  node_content.append(node => create_node_element(options, node));
}

/**
 * Creates the D3 content for a single node.
 * @param {!options} options Dictionary of configurations.
 * @param {!node} node Node to draw.
 * @return {!d3} D3 content.
 */
function create_node_element(options, node) {
  // Output accumulator.
  let output = {
    // Content to draw.
    content: d3.create('svg:g'),
    // Vertical offset to the next element to draw.
    vertical_offset: 0
  };

  // Conditions.
  if (node.data.condition != null) {
    display_condition(options, node.data.condition, output);
  }

  // Values.
  if (node.data.value != null) {
    display_value(options, node.data.value, output);
  }

  // Explanations.
  if (node.data.explanation != null) {
    display_explanation(options, node.data.explanation, output);
  }

  return output.content.node();
}


/**
 * Adds a single line of text inside of a node.
 * @param {!options} options Dictionary of configurations.
 * @param {string} text Text to display.
 * @param {!output} output Output display accumulator.
 */
function display_node_text(options, text, output) {
  output.content.append('text')
      .attr('x', options.node_padding)
      .attr('y', output.vertical_offset)
      .attr('alignment-baseline', 'hanging')
      .text(text);
  output.vertical_offset += 10;
}

/**
 * Adds a single line of text inside of a node with a tooltip.
 * @param {!options} options Dictionary of configurations.
 * @param {string} text Text to display.
 * @param {string} tooltip Text in the Tooltip.
 * @param {!output} output Output display accumulator.
 */
function display_node_text_with_tooltip(options, text, tooltip, output) {
  const item = output.content.append('text')
                   .attr('x', options.node_padding)
                   .attr('alignment-baseline', 'hanging')
                   .text(text);

  add_tooltip(options, item, () => tooltip);
  output.vertical_offset += 10;
}

/**
 * Adds a tooltip to a dom element.
 * @param {!options} options Dictionary of configurations.
 * @param {!dom} target Dom element to equip with a tooltip.
 * @param {!func} get_content Generates the html content of the tooltip.
 */
function add_tooltip(options, target, get_content) {
  function show(d) {
    options.tooltip.style('display', 'block');
    options.tooltip.html(get_content());
  }

  function hide(d) {
    options.tooltip.style('display', 'none');
  }

  function move(d) {
    options.tooltip.style('display', 'block');
    options.tooltip.style('left', (d.pageX + 5) + 'px');
    options.tooltip.style('top', d.pageY + 'px');
  }

  target.on('mouseover', show);
  target.on('mouseout', hide);
  target.on('mousemove', move);
}

/**
 * Adds a condition inside of a node.
 * @param {!options} options Dictionary of configurations.
 * @param {!condition} condition Condition to display.
 * @param {!output} output Output display accumulator.
 */
function display_condition(options, condition, output) {
  threshold_format = d3.format('r');

  if (condition.type === 'IS_MISSING') {
    display_node_text(options, `${condition.attribute} is missing`, output);
    return;
  }

  if (condition.type === 'IS_TRUE') {
    display_node_text(options, `${condition.attribute} is true`, output);
    return;
  }

  if (condition.type === 'NUMERICAL_IS_HIGHER_THAN') {
    format = d3.format('r');
    display_node_text(
        options,
        `${condition.attribute} >= ${threshold_format(condition.threshold)}`,
        output);
    return;
  }

  if (condition.type === 'CATEGORICAL_IS_IN') {
    display_node_text_with_tooltip(
        options, `${condition.attribute} in [...]`,
        `${condition.attribute} in [${condition.mask}]`, output);
    return;
  }

  if (condition.type === 'CATEGORICAL_SET_CONTAINS') {
    display_node_text_with_tooltip(
        options, `${condition.attribute} intersect [...]`,
        `${condition.attribute} intersect [${condition.mask}]`, output);
    return;
  }

  if (condition.type === 'NUMERICAL_SPARSE_OBLIQUE') {
    display_node_text_with_tooltip(
        options, `Sparse oblique split...`,
        `[${condition.attributes}]*[${condition.weights}]>=${
            threshold_format(condition.threshold)}`,
        output);
    return;
  }

  display_node_text(
      options, `Non supported condition ${condition.type}`, output);
}

/**
 * Adds a value inside of a node.
 * @param {!options} options Dictionary of configurations.
 * @param {!value} value Value to display.
 * @param {!output} output Output display accumulator.
 */
function display_value(options, value, output) {
  if (value.type === 'PROBABILITY') {
    const left_margin = 0;
    const right_margin = 50;
    const plot_width = options.node_x_size - options.node_padding * 2 -
        left_margin - right_margin;

    let cusum = Array.from(d3.cumsum(value.distribution));
    cusum.unshift(0);
    const distribution_plot = output.content.append('g').attr(
        'transform', `translate(0,${output.vertical_offset + 0.5})`);

    distribution_plot.selectAll('rect')
        .data(value.distribution)
        .join('rect')
        .attr('height', 10)
        .attr(
            'x',
            (d, i) =>
                (cusum[i] * plot_width + left_margin + options.node_padding))
        .attr('width', (d, i) => d * plot_width)
        .style('fill', (d, i) => d3.schemeSet1[i]);

    const num_examples =
        output.content.append('g')
            .attr('transform', `translate(0,${output.vertical_offset})`)
            .append('text')
            .attr('x', options.node_x_size - options.node_padding)
            .attr('alignment-baseline', 'hanging')
            .attr('text-anchor', 'end')
            .text(`(${value.num_examples})`);

    const distribution_details = d3.create('ul');
    distribution_details.selectAll('li')
        .data(value.distribution)
        .join('li')
        .append('span')
        .text(
            (d, i) =>
                'class ' + i + ': ' + d3.format('.3%')(value.distribution[i]));

    add_tooltip(options, distribution_plot, () => distribution_details.html());
    add_tooltip(options, num_examples, () => 'Number of examples');

    output.vertical_offset += 10;
    return;
  }

  if (value.type === 'REGRESSION') {
    display_node_text(
        options,
        'value: ' + d3.format('r')(value.value) + ` (` +
            d3.format('.6')(value.num_examples) + `)`,
        output);
    return;
  }

  display_node_text(options, `Non supported value ${value.type}`, output);
}

/**
 * Adds an explanation inside of a node.
 * @param {!options} options Dictionary of configurations.
 * @param {!explanation} explanation Explanation to display.
 * @param {!output} output Output display accumulator.
 */
function display_explanation(options, explanation, output) {
  // Margin before the explanation.
  output.vertical_offset += 10;

  display_node_text(
      options, `Non supported explanation ${explanation.type}`, output);
}


/**
 * Draw the edges of the tree.
 * @param {!options} options Dictionary of configurations.
 * @param {!graph} graph D3 search handle containing the graph.
 * @param {!tree_struct} tree_struct Structure of the tree (node placement,
 *     data, etc.).
 */
function display_edges(options, graph, tree_struct) {
  // Draw an edge between a parent and a child node with a bezier.
  function draw_single_edge(d) {
    return 'M' + (d.source.y + options.node_x_size) + ',' + d.source.x + ' C' +
        (d.source.y + options.node_x_size + options.edge_rounding) + ',' +
        d.source.x + ' ' + (d.target.y - options.edge_rounding) + ',' +
        d.target.x + ' ' + d.target.y + ',' + d.target.x;
  }

  graph.append('g')
      .attr('fill', 'none')
      .attr('stroke-width', 1.2)
      .selectAll('path')
      .data(tree_struct.links())
      .join('path')
      .attr('d', draw_single_edge)
      .attr(
          'stroke', d => (d.target === d.source.children[0]) ? '#0F0' : '#F00');
}

display_tree({"margin": 10, "node_x_size": 160, "node_y_size": 28, "node_x_offset": 180, "node_y_offset": 33, "font_size": 10, "edge_rounding": 20, "node_padding": 2, "show_plot_bounding_box": false}, {"value": {"type": "PROBABILITY", "distribution": [0.9492568486212267, 0.05074315137877326], "num_examples": 108564.4013897106}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "category", "mask": ["grocery_pos", "shopping_pos", "shopping_net", "misc_net"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.8922905760224614, 0.10770942397753863], "num_examples": 35495.500370673835}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "amt", "threshold": 257.625}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.26694566298629696, 0.733054337013703], "num_examples": 5209.299919560552}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "gender", "mask": ["M"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.165170147138785, 0.834829852861215], "num_examples": 2594.8999489992857}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "state", "mask": ["TX", "NY", "PA", "CA", "OH", "FL", "MO", "MN", "WI", "SC", "VA", "GA", "WV", "NE", "KS", "MS", "WY", "WA", "OR", "TN", "ME", "ND", "CO", "SD", "MA", "MT", "VT", "AZ", "UT", "NH", "NV", "DC"]}}, {"value": {"type": "PROBABILITY", "distribution": [0.3679620659299474, 0.6320379340700526], "num_examples": 2614.399970561266}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "city_pop", "threshold": 2864.0}}]}, {"value": {"type": "PROBABILITY", "distribution": [0.9998514174834161, 0.0001485825165838951], "num_examples": 30286.200451113284}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "category", "mask": ["grocery_pos"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.9995395477526019, 0.0004604522473980614], "num_examples": 9773.000145442784}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "city", "mask": ["Birmingham", "San Antonio", "Meridian", "Utica", "Warren", "Houston", "Naples", "Arcadia", "Burbank", "Indianapolis", "Brandon", "Fulton", "Allentown", "Andrews", "Washington", "Orient", "Fort Washakie", "Philadelphia", "Bradley", "East Canaan", "De Witt", "Tulsa", "Whaleyville", "Bowdoin", "Morrisdale", "Elberta", "Bauxite", "De Soto", "Norwalk", "Goodrich", "Florence", "Baton Rouge", "Thompson", "Topeka", "Roma", "Norman", "Sebring", "Grandview", "Wetmore", "Reno", "Ranier", "Thida", "Pembroke Township", "Clarks Mills", "Glendale", "Grover", "Meadville", "New Holstein", "Red River", "Issaquah", "Bessemer", "Smiths Grove", "Elizabeth", "Esbon", "Sherman", "Moriarty", "Bagley", "Spencer", "Redford", "Hannawa Falls", "Rock Springs", "Murfreesboro", "Cochranton", "Stanchfield", "Mulberry Grove", "Muskegon", "Haw River", "Drakes Branch", "Lanark Village", "Knoxville", "Denham Springs", "Winfield", "Mobile", "Leonard", "Sachse", "Armagh", "Diamond", "Fayetteville", "Fenelton", "Brunson", "Saint Amant", "Barneveld", "Basye", "Altonah", "Saxon", "Woodville", "Barnstable", "Westerville", "Keisterville", "Coffeeville", "Comfrey", "Bridger", "Noonan", "Parsonsfield", "North Prairie", "High Rolls Mountain Park", "Altair", "Mount Saint Joseph", "Lawn", "Sacramento", "Nobleboro", "Falconer", "Saint Paul", "Plantersville", "Logan", "Cord", "Steuben", "Grant", "Shippingport", "Clayton", "New Boston", "Holliday", "Wilmette", "Tomales", "Cascade Locks", "Mount Hope", "Grassflat", "Pittsburgh", "Garrattsville", "Meredith", "Louisville", "Atlantic", "Brownville", "Altona", "Sontag", "Scotia", "Egan", "Afton", "Manderson", "Mountain Park", "Holcomb", "Ogdensburg", "Nazareth", "Mound City", "Dunlevy", "Laramie", "May", "San Jose", "Bolton", "Bronx", "O Brien", "Burlington", "Harper", "Mayersville", "Mesa", "Hewitt", "Surrency", "Notrees", "Freedom", "North Loup", "Manville", "Lonsdale", "Falmouth", "Port Costa", "Kirby", "Kansas City", "Tyaskin", "Shenandoah Junction", "Mifflin", "Roosevelt", "Lakeport", "Schaefferstown", "Saint Petersburg", "Battle Creek", "Phenix City", "Delhi", "Grenada", "Zaleski", "Quanah", "Fairview", "Jermyn", "Big Indian", "Randolph", "Milwaukee", "Dieterich", "Vero Beach", "Fields Landing", "Minneapolis", "Mansfield", "University", "Blackville", "West Columbia", "Montandon", "East Andover", "Greendale", "Great Mills", "Santa Monica", "Sturgis", "Luray", "Saint James City", "Darien", "Lowell", "Des Moines", "Cass", "West Palm Beach", "Ozawkie", "Irwinton", "Wales", "Tomahawk", "Lima", "Bay Minette", "Paauilo", "June Lake", "Hawthorne", "Manchester", "Laredo", "Big Creek", "Shelter Island", "Mount Perry", "West Harrison", "Cedar", "Titusville", "Stephensport", "Laguna Hills", "Indian Wells", "Greenview", "Moro", "Timberville", "Irvine", "Arlington", "Moulton", "Joliet", "Eldridge", "Bridgeport", "Kilgore", "Howells", "Valdosta", "Mooresville", "Manley", "Coyle", "Zavalla", "Harrington Park", "Fullerton", "Dumont", "Bowersville", "Athena", "Bonfield", "Margaretville", "Cranks", "Scarborough", "Waupaca", "Marienville", "Collettsville", "Henderson", "Farmington", "Bailey", "Matthews", "Port Gibson", "Keller", "Holloway", "Highland", "Hatch", "Orangeburg", "Corsica", "Mill Creek", "Colorado Springs", "Hawley", "Mounds", "Elkhart", "Campbell", "Rhame", "Amanda", "Daly City", "Belfast", "Purmela", "Cadiz", "Powell", "River", "Lowville", "Bristol", "Sula", "Port Ewen", "Paint Rock", "Spring Church", "Burke", "West Henrietta", "North Tonawanda", "Amsterdam", "Heislerville", "Bristow", "Halma", "Westhampton Beach", "Ridgeland", "Orr", "Texarkana", "Duncan", "Dubre", "Oklahoma City", "Hampton", "Scotts Mills", "Brinson", "Mount Clemens", "Stayton", "Ringwood", "Pueblo", "Pembroke", "Hurley", "Parks", "Hedley", "Pikesville", "Marion", "Brantley", "Auburn", "Ashford", "Albany", "Port Charlotte", "Paradise Valley", "Atglen", "Saint Louis", "Eagarville", "Bay City", "Manor", "Corona", "Port Richey", "Falls Church", "Metairie", "Cressona", "East Troy", "Avera", "Umatilla", "Weeping Water", "Unionville", "Smith River", "Goreville", "Armonk", "Cape Coral", "Winslow", "Vinton", "Tamaroa", "Queenstown", "Oriskany Falls", "Minnesota Lake", "Tiptonville", "Glade Spring", "Easton", "Carroll", "South Hero", "Center Tuftonboro", "Grand Ridge", "Lebanon", "Dongola", "Haines City", "Beasley", "Mendon", "Olmsted", "Clune", "West Monroe", "Prosperity", "Montgomery", "Miamisburg", "Luzerne", "Ashfield", "Blairsden-Graeagle", "Nelson", "Brooklin", "Lagrange", "Crownpoint", "Alton", "Wauchula", "Parkers Lake", "West Decatur", "Haynes", "Lakeview", "Rockwood", "Grimesland", "New Memphis", "Winthrop", "Mc Intosh", "Maria Stein", "Saint Francis", "Red Cliff", "Hills", "Ravenna", "Ehrhardt", "Monitor", "Omaha", "Pearlington", "Brainard", "Livonia", "Huslia", "Du Pont", "Dalton", "Spring", "Sprague", "Wendel", "Sardis", "Apison", "Annapolis", "Los Angeles", "Girard", "Dayton", "West Chazy", "Linthicum Heights", "Kittery Point", "Greenbush", "Wittenberg", "Odessa", "Brashear", "Achille", "Port Saint Lucie", "Nokomis", "Hazel", "Daniels", "Yellowstone National Park", "Washoe Valley", "Oakford", "Newton", "Damascus", "Smithfield", "Parker Dam", "Adams", "Rock Glen", "Liberty Mills", "Richland", "Pea Ridge", "Moscow", "Ferney", "Claremont", "Spirit Lake", "Shedd", "Hartford", "Dexter", "Hopewell", "Republic", "Whittemore", "West Bethel", "Northport", "Amorita", "South Richmond Hill", "Chatham", "Boulder", "Valentine", "Moores Hill", "Rockwell", "Palmdale", "Lorenzo", "Jay", "Premier", "Remer", "Paxton", "Loami", "Manquin", "Collegeville", "Vancouver", "Trenton", "Rochester", "Cardwell", "Arvada", "De Lancey", "Louisiana", "Jackson", "Akron", "Thornville", "Ragland", "Riverview", "Humboldt", "Garfield", "Michigan", "Lithopolis", "Early"]}}, {"value": {"type": "PROBABILITY", "distribution": [1.0, 0.0], "num_examples": 20513.2003056705}}]}]}, {"value": {"type": "PROBABILITY", "distribution": [0.9769299944048013, 0.023070005595198725], "num_examples": 73068.90101903677}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "job", "mask": ["Naval architect", "IT trainer", "Systems developer", "Financial adviser", "Environmental consultant", "Scientist, audiological", "Chief Executive Officer", "Sub", "Magazine features editor", "Librarian, public", "Building surveyor", "Musician", "Mining engineer", "Immunologist", "Clothing/textile technologist", "Financial trader", "Prison officer", "Engineer, automotive", "Energy engineer", "Make", "Mechanical engineer", "Land/geomatics surveyor", "Quantity surveyor", "Sales professional, IT", "Counsellor", "Pensions consultant", "Insurance underwriter", "Television production assistant", "Science writer", "Engineer, biomedical", "Multimedia programmer", "Accounting technician", "Radio broadcast assistant", "Trading standards officer", "Physiotherapist", "Fine artist", "Surveyor, minerals", "Therapist, occupational", "Advertising account planner", "Surgeon", "English as a second language teacher", "Television/film/video producer", "Exhibitions officer, museum/gallery", "Occupational psychologist", "Futures trader", "Scientist, biomedical", "Applications developer", "Pilot, airline", "Probation officer", "Engineering geologist", "Development worker, community", "Public relations account executive", "Editor, commissioning", "Dispensing optician", "Administrator", "Engineer, electronics", "Forensic psychologist", "Retail merchandiser", "Broadcast presenter", "Insurance broker", "Private music teacher", "Travel agency manager", "Psychologist, counselling", "Structural engineer", "Colour technologist", "Tourist information centre manager", "Phytotherapist", "Regulatory affairs officer", "Journalist, newspaper", "Geologist, engineering", "Metallurgist", "Press sub", "Arboriculturist", "Radiographer, diagnostic", "Designer, exhibition/display", "Warden/ranger", "Music tutor", "Leisure centre manager", "Product/process development scientist", "Engineer, land", "Careers information officer", "Administrator, local government", "Statistician", "Osteopath", "Health and safety adviser", "Therapist, sports", "Risk analyst", "Tourism officer", "Nurse, children's", "Community arts worker", "Human resources officer", "Investment analyst", "Accountant, chartered public finance", "Police officer", "Maintenance engineer", "Bookseller", "Web designer", "Media buyer", "Optician, dispensing", "Armed forces training and education officer", "Therapist, horticultural", "Paediatric nurse", "Intelligence analyst", "Horticultural therapist", "Scientist, physiological", "Nutritional therapist", "Retail buyer", "Neurosurgeon", "Psychologist, sport and exercise", "Sports development officer", "Industrial/product designer", "Chief Marketing Officer", "Geologist, wellsite", "Clinical research associate", "Editor, magazine features", "Immigration officer", "Retail banker", "Landscape architect", "Pension scheme manager", "Civil engineer, contracting", "Biomedical engineer", "Public affairs consultant", "Herpetologist", "Animal technologist", "Psychotherapist", "Investment banker, corporate", "Public house manager", "Medical secretary", "Arts development officer", "Furniture designer", "Cartographer", "Health promotion specialist", "Communications engineer", "Health visitor", "General practice doctor", "Theme park manager", "Planning and development surveyor", "Pharmacologist", "Psychologist, clinical", "Advertising account executive", "Theatre manager", "Logistics and distribution manager", "Community pharmacist", "Designer, interior/spatial", "Sales executive", "Network engineer", "Social research officer, government", "Geophysicist/field seismologist", "Mudlogger", "Production engineer", "Diagnostic radiographer", "Optometrist", "Environmental health practitioner", "Engineer, civil (contracting)", "Aeronautical engineer", "Management consultant", "Building services engineer", "Garment/textile technologist", "Records manager", "Emergency planning/management officer", "Quarry manager", "Conservation officer, historic buildings", "Location manager", "Teacher, primary school", "Media planner", "Plant breeder/geneticist", "Engineer, building services", "Economist", "Presenter, broadcasting", "Medical technical officer", "Designer, multimedia", "Pathologist", "Company secretary", "Retail manager", "Biochemist, clinical", "Stage manager", "Engineer, aeronautical", "Jewellery designer", "Designer, textile", "Education administrator", "Academic librarian", "Air broker", "Art gallery manager", "Teacher, English as a foreign language", "Chartered legal executive (England and Wales)", "Loss adjuster, chartered", "IT consultant", "Architectural technologist", "Visual merchandiser", "Scientist, research (medical)", "Engineer, manufacturing", "Lawyer", "Engineer, materials", "Horticultural consultant", "Accountant, chartered certified", "Merchandiser, retail", "Production assistant, television", "Field trials officer", "Community development worker", "Teacher, adult education", "Occupational therapist", "Restaurant manager, fast food", "Conservator, museum/gallery", "TEFL teacher", "Interior and spatial designer", "Broadcast engineer", "Charity officer", "Marketing executive", "Oncologist", "Local government officer", "Nature conservation officer", "Education officer, community", "English as a foreign language teacher", "Investment banker, operational", "Writer", "Producer, television/film/video", "Civil Service administrator", "Dancer", "Legal secretary", "Solicitor", "Personnel officer", "Forest/woodland manager", "Broadcast journalist", "Armed forces technical officer"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.9719535237622633, 0.02804647623773675], "num_examples": 32988.10045326501}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "state", "mask": ["NY", "OH", "MO", "NC", "VA", "IA", "GA", "MD", "WV", "KS", "MS", "OR", "TN", "NM", "CO", "AZ", "UT", "AK", "RI", "DE"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.9605664730560614, 0.0394335269439386], "num_examples": 12484.300165653229}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "job", "mask": ["Systems developer", "Scientist, audiological", "Sub", "Building surveyor", "Financial trader", "Prison officer", "Engineer, automotive", "Mechanical engineer", "Land/geomatics surveyor", "Quantity surveyor", "Counsellor", "Radio broadcast assistant", "Fine artist", "Surveyor, minerals", "Therapist, occupational", "Exhibitions officer, museum/gallery", "Scientist, biomedical", "Engineering geologist", "Forensic psychologist", "Retail merchandiser", "Insurance broker", "Private music teacher", "Travel agency manager", "Colour technologist", "Tourist information centre manager", "Phytotherapist", "Regulatory affairs officer", "Geologist, engineering", "Arboriculturist", "Radiographer, diagnostic", "Warden/ranger", "Music tutor", "Administrator, local government", "Statistician", "Tourism officer", "Nurse, children's", "Human resources officer", "Maintenance engineer", "Armed forces training and education officer", "Geologist, wellsite", "Civil engineer, contracting", "Psychotherapist", "Planning and development surveyor", "Advertising account executive", "Community pharmacist", "Network engineer", "Mudlogger", "Location manager", "Designer, multimedia", "Company secretary", "Jewellery designer", "Designer, textile", "Teacher, English as a foreign language", "IT consultant", "Architectural technologist", "Lawyer", "Production assistant, television", "Field trials officer", "Community development worker", "Conservator, museum/gallery", "Local government officer", "Education officer, community", "Armed forces technical officer"]}}, {"value": {"type": "PROBABILITY", "distribution": [0.9788868413435717, 0.02111315865642823], "num_examples": 20503.800287611783}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "amt", "threshold": 235.63999938964844}}]}, {"value": {"type": "PROBABILITY", "distribution": [0.981025828598267, 0.018974171401732992], "num_examples": 40080.80056577176}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "state", "mask": ["PA", "IL", "AL", "MN", "AR", "NC", "SC", "VA", "OK", "WV", "NE", "KS", "WY", "WA", "TN", "ME", "NV", "HI", "AK"]}, "children": [{"value": {"type": "PROBABILITY", "distribution": [0.9733695558930082, 0.026630444106991752], "num_examples": 15681.300216384232}, "condition": {"type": "CATEGORICAL_IS_IN", "attribute": "city", "mask": ["Conway", "Cleveland", "Allentown", "Orient", "Fort Washakie", "Bradley", "Uledi", "Tulsa", "Jones", "Clarks Mills", "Grover", "Ruckersville", "Johns Island", "Stanchfield", "Haw River", "Winfield", "Fayetteville", "Fenelton", "Brunson", "Murrayville", "North Washington", "Westerville", "Creedmoor", "Lawn", "Saint Paul", "Cord", "Grant", "Shippingport", "Wilmette", "Pittsburgh", "Mountain Park", "Mc Nabb", "Manville", "Doe Hill", "Roosevelt", "Beaver Falls", "West Columbia", "Montandon", "East Andover", "Ruth", "Cass", "Wales", "Paauilo", "Mc Cracken", "Harborcreek", "Eldridge", "Viola", "Howells", "Fullerton", "Ash Flat", "Marienville", "Bailey", "Mounds", "Ford", "Powell", "Bristol", "Clifton", "Lonetree", "Sauk Rapids", "Stillwater", "Brantley", "Schaumburg", "Weeping Water", "Smock", "Leetsdale", "Glade Spring", "Grand Bay", "Clune", "Prosperity", "West Decatur", "Tryon", "New Memphis", "Hills", "Cross", "Dublin", "Dadeville", "Huslia", "Sprague", "Sardis", "Burns Flat", "Marietta", "Lepanto", "Washoe Valley", "North Las Vegas", "Pea Ridge", "Dexter", "Hopewell", "Rossville", "Remer", "Monetta", "Ragland", "Garfield", "Wartburg", "Seattle", "North East", "Roland"]}}, {"value": {"type": "PROBABILITY", "distribution": [0.9859464339020836, 0.01405356609791641], "num_examples": 24399.500349387527}, "condition": {"type": "NUMERICAL_IS_HIGHER_THAN", "attribute": "amt", "threshold": 24.03499984741211}}]}]}]}, "#tree_plot_93339f508e1d4f5980ac5dacfec565b6")
</script>
